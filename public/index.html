<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accret Wallet Transaction</title>
    <!-- Include Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accret-blue': '#2E85FE',
                        'accret-light': '#E6F2FF',
                        'accret-dark': '#1A75EA'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full">
        <!-- Logo and Title -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-accret-blue mb-2">Accret Wallet Transaction</h1>
            <p class="text-gray-600">You're about to execute a transaction in Accret Wallet</p>
        </div>

        <!-- Transaction Card -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex items-start space-x-4 mb-6">
                <div class="rounded-full bg-accret-light p-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accret-blue" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="flex-1">
                    <h2 class="text-lg font-semibold text-gray-800 mb-1">Donate SOL</h2>
                    <p class="text-gray-600 text-sm">You're about to make a donation using Solana. This transaction will open in your Accret Wallet for confirmation.</p>
                </div>
            </div>

            <a href="accret://authenticated/dialect-blink?url=https://www.dialswap.fun/api/actions/donate-sol" 
               class="block w-full bg-accret-blue hover:bg-accret-dark text-white text-center py-4 px-6 rounded-lg font-medium transition-colors duration-200 ease-in-out">
                Execute Transaction
            </a>
        </div>

        <!-- Security Note -->
        <div class="bg-accret-light rounded-lg p-4">
            <div class="flex items-start space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accret-blue mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-sm text-gray-600">
                    You'll be redirected to Accret Wallet where you can review the transaction details before confirming.
                </p>
            </div>
        </div>

        <footer class="text-center mt-8">
            <p class="text-sm text-gray-500">Powered by Accret Wallet</p>
        </footer>
    </div>

    <script>
        function convertDialToUrl(dialToUrl) {
            try {
                let url;
                let actionUrl;

                if (dialToUrl.includes('jupiter.dial.to') || dialToUrl.includes('dialswap.fun')) {
                    actionUrl = dialToUrl;
                } else {
                    url = new URL(dialToUrl);
                    const action = url.searchParams.get('action');
                    
                    if (!action || !action.startsWith('solana-action:')) {
                        throw new Error('Invalid dial.to URL format');
                    }
                    
                    actionUrl = action.substring('solana-action:'.length);
                }

                actionUrl = actionUrl.replace(/\?/g, '%3F').replace(/&/g, '%26');
                return `accret://authenticated/dialect-blink?url=${encodeURIComponent(actionUrl)}`;
            } catch (error) {
                console.error('Error:', error.message);
                return null;
            }
        }

        // Handle URL parameters on page load
        window.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url') || urlParams.get('action');

            if (url) {
                try {
                    const accretUrl = convertDialToUrl(url);
                    if (accretUrl) {
                        window.location.href = accretUrl;
                    }
                } catch (error) {
                    console.error('Error:', error.message);
                }
            }
        });
    </script>
</body>

</html>